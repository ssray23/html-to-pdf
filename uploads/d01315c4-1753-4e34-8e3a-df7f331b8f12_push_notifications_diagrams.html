<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Push Notifications Guide - Visual Diagrams</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8f9fa;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            font-weight: 300;
        }

        h2 {
            color: #34495e;
            margin: 40px 0 20px 0;
            font-size: 1.8em;
            font-weight: 400;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        h3 {
            color: #2c3e50;
            margin: 30px 0 15px 0;
            font-size: 1.4em;
        }

        .diagram {
            background: white;
            border: 1px solid #e1e8ed;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
        }

        .flow-diagram {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
            min-height: 200px;
        }

        .node {
            background: #3498db;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            text-align: center;
            min-width: 120px;
            position: relative;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .node.client { background: #e1f5fe; color: #333; }
        .node.server { background: #f3e5f5; color: #333; }
        .node.database { background: #c8e6c9; color: #333; }
        .node.service { background: #f8bbd9; color: #333; }
        .node.queue { background: #fff9c4; color: #333; }
        .node.warning { background: #fff3e0; color: #333; }
        .node.error { background: #ffebee; color: #333; }
        .node.success { background: #e8f5e8; color: #333; }
        .node.info { background: #e3f2fd; color: #333; }

        .arrow {
            font-size: 24px;
            color: #3498db;
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 0 0 30px;
        }

        .arrow::after {
            content: '→';
        }

        .timeline {
            background: #fff3e0;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
            font-style: italic;
            border-left: 4px solid #f39c12;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
        }

        .comparison-table th,
        .comparison-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        .comparison-table th {
            background: #3498db;
            color: white;
            font-weight: 500;
        }

        .comparison-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .network-stack {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 600px;
            margin: 0 auto;
        }

        .layer {
            padding: 15px;
            border-radius: 6px;
            text-align: center;
            position: relative;
        }

        .layer.aws { background: #bbdefb; }
        .layer.internet { background: #fff9c4; }
        .layer.azure { background: #f8bbd9; }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .metric-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .metric-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .metric-value {
            font-size: 1.2em;
            color: #27ae60;
        }

        .architecture-diagram {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 20px 0;
        }

        .arch-section {
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            padding: 15px;
        }

        .arch-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
            background: #ecf0f1;
            padding: 8px;
            border-radius: 4px;
        }

        .decision-tree {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .decision-node {
            background: white;
            border: 2px solid #3498db;
            padding: 15px;
            border-radius: 8px;
            margin: 10px;
            text-align: center;
            position: relative;
        }

        .decision-options {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }

        .option {
            background: #e8f5e8;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #27ae60;
        }

        .websocket-flow {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 20px;
            align-items: center;
            margin: 20px 0;
        }

        .connection-phase {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #bdc3c7;
        }

        .bidirectional {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #e3f2fd;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .message {
            background: white;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #3498db;
            max-width: 200px;
        }

        .performance-bars {
            margin: 20px 0;
        }

        .perf-item {
            margin: 10px 0;
        }

        .perf-label {
            display: inline-block;
            width: 150px;
            font-weight: 500;
        }

        .perf-bar {
            display: inline-block;
            height: 20px;
            background: #3498db;
            margin-left: 10px;
            border-radius: 4px;
            position: relative;
        }

        .perf-text {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            font-size: 12px;
        }

        .code-example {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 6px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 15px 0;
        }

        .highlight {
            background: #f1c40f;
            color: #2c3e50;
            padding: 2px 4px;
            border-radius: 3px;
        }

        @media (max-width: 768px) {
            .flow-diagram {
                flex-direction: column;
            }
            
            .arrow::after {
                content: '↓';
            }
            
            .architecture-diagram {
                grid-template-columns: 1fr;
            }
            
            .websocket-flow {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Push Notifications & Real-Time Communication</h1>
        <p style="text-align: center; color: #666; margin-bottom: 40px;">Visual Guide to Modern Event-Driven Architecture</p>

        <h2>1. The Fundamental Problem: Polling vs Push</h2>
        
        <h3>Traditional Polling Approach (The Hard Way)</h3>
        <div class="diagram">
            <div class="flow-diagram">
                <div class="node client">Client</div>
                <div class="arrow"></div>
                <div class="node server">Server/Database</div>
            </div>
            <div style="margin: 20px 0;">
                <div style="background: #fff3e0; padding: 10px; border-radius: 4px; margin: 5px 0;">
                    <strong>Request 1:</strong> "Any new orders?" → "No new orders"
                </div>
                <div style="background: #fff3e0; padding: 10px; border-radius: 4px; margin: 5px 0;">
                    <strong>Request 2:</strong> "Any new orders?" → "No new orders"
                </div>
                <div style="background: #fff3e0; padding: 10px; border-radius: 4px; margin: 5px 0;">
                    <strong>Request 3:</strong> "Any new orders?" → "Yes! Order #123"
                </div>
            </div>
            <div class="timeline">
                <strong>Timeline:</strong> Wasted requests every 30 seconds<br>
                Order created at 2:15pm, discovered at 2:16pm<br>
                <span class="highlight">59 seconds of delay</span>
            </div>
        </div>

        <h3>Modern Push Approach (The Smart Way)</h3>
        <div class="diagram">
            <div class="flow-diagram">
                <div class="node database">Database</div>
                <div class="arrow"></div>
                <div class="node info">Application Server</div>
                <div class="arrow"></div>
                <div class="node service">Multiple Services</div>
            </div>
            <div style="margin: 20px 0;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div class="node service">Email Service</div>
                    <div class="node service">Mobile App</div>
                    <div class="node service">Analytics System</div>
                    <div class="node service">Warehouse System</div>
                </div>
            </div>
            <div class="timeline" style="background: #e8f5e8; border-left-color: #27ae60;">
                <strong>Timeline:</strong> Order created at 2:15:00pm<br>
                All systems notified by 2:15:01pm<br>
                <span class="highlight">1 second total delay</span>
            </div>
        </div>

        <h2>2. Database Change Detection Methods</h2>
        
        <div class="architecture-diagram">
            <div class="arch-section" style="border-color: #3498db;">
                <div class="arch-title">Method 1: Application-Level</div>
                <div class="flow-diagram" style="flex-direction: column;">
                    <div class="node info">HTTP POST /orders</div>
                    <div class="arrow" style="transform: rotate(90deg);">→</div>
                    <div class="node info">Flask App</div>
                    <div class="arrow" style="transform: rotate(90deg);">→</div>
                    <div class="node database">Save to Database</div>
                    <div class="arrow" style="transform: rotate(90deg);">→</div>
                    <div class="node service">Immediate Notification</div>
                </div>
            </div>
            
            <div class="arch-section" style="border-color: #f39c12;">
                <div class="arch-title">Method 2: Background Polling</div>
                <div class="flow-diagram" style="flex-direction: column;">
                    <div class="node warning">Background Process</div>
                    <div class="arrow" style="transform: rotate(90deg);">→</div>
                    <div class="node warning">Query Recent Changes</div>
                    <div class="arrow" style="transform: rotate(90deg);">→</div>
                    <div class="node warning">Check Every 10s</div>
                    <div class="arrow" style="transform: rotate(90deg);">→</div>
                    <div class="node service">Send Notifications</div>
                </div>
            </div>
            
            <div class="arch-section" style="border-color: #9b59b6;">
                <div class="arch-title">Method 3: Database Triggers</div>
                <div class="flow-diagram" style="flex-direction: column;">
                    <div class="node" style="background: #f3e5f5; color: #333;">Database INSERT/UPDATE</div>
                    <div class="arrow" style="transform: rotate(90deg);">→</div>
                    <div class="node" style="background: #f3e5f5; color: #333;">Database Trigger</div>
                    <div class="arrow" style="transform: rotate(90deg);">→</div>
                    <div class="node" style="background: #f3e5f5; color: #333;">NOTIFY Channel</div>
                    <div class="arrow" style="transform: rotate(90deg);">→</div>
                    <div class="node service">Send Notifications</div>
                </div>
            </div>
        </div>

        <h2>3. Webhook Architecture</h2>
        
        <div class="diagram">
            <div class="flow-diagram">
                <div class="node success">Order Created</div>
                <div class="arrow"></div>
                <div class="node info">Your Server</div>
                <div class="arrow"></div>
                <div class="node warning">HTTP POST<br>https://partner-api.com</div>
                <div class="arrow"></div>
                <div class="node service">Partner Server</div>
                <div class="arrow"></div>
                <div class="node" style="background: #d1c4e9; color: #333;">Process Data</div>
            </div>
            <div style="margin: 20px 0;">
                <div class="node" style="background: #c8e6c9; color: #333; margin: 10px auto; max-width: 400px;">
                    HTTP 200 Response: {'status': 'success', 'processed_at': '2025-08-11T14:30:00Z'}
                </div>
            </div>
            <div class="timeline">
                <strong>Network Path:</strong> London → Internet → Azure West Europe<br>
                <strong>Latency:</strong> ~50-200ms<br>
                <strong>Protocol:</strong> HTTPS over TCP/IP
            </div>
        </div>

        <h2>4. Network Level Understanding</h2>
        
        <div class="diagram">
            <div class="network-stack">
                <div class="layer aws">
                    <strong>Your AWS Server (London)</strong><br>
                    Order Created → Webhook Handler
                </div>
                <div class="layer internet">
                    <strong>Internet Infrastructure</strong><br>
                    London ISP → Internet Backbone → European Network → Azure Network
                </div>
                <div class="layer azure">
                    <strong>Azure SaaS (West Europe)</strong><br>
                    Load Balancer → App Service → Webhook Endpoint → Database
                </div>
            </div>
            <div class="timeline">
                <strong>Network Details:</strong><br>
                • Protocol: HTTPS (Port 443)<br>
                • Latency: 50-200ms<br>
                • Same as browsing a website<br>
                • No persistent connection<br>
                • Each webhook = new TCP connection
            </div>
        </div>

        <h2>5. WebSockets for Real-Time Chat</h2>
        
        <div class="diagram">
            <h3>WebSocket Handshake Process</h3>
            <div class="websocket-flow">
                <div class="connection-phase">
                    <strong>Browser</strong><br>
                    Sends HTTP upgrade request
                </div>
                <div class="connection-phase">
                    <strong>Handshake</strong><br>
                    GET /chat HTTP/1.1<br>
                    Connection: Upgrade<br>
                    Upgrade: websocket
                </div>
                <div class="connection-phase">
                    <strong>Server</strong><br>
                    HTTP 101 Switching Protocols<br>
                    Connection established
                </div>
            </div>
            
            <h3>Persistent Bidirectional Communication</h3>
            <div class="bidirectional">
                <div class="message">Browser<br>"Hello!"</div>
                <div style="display: flex; flex-direction: column; align-items: center;">
                    <div class="arrow" style="margin: 5px;">→</div>
                    <div class="node info">Server</div>
                    <div class="arrow" style="margin: 5px; transform: rotate(180deg);">→</div>
                </div>
                <div class="message">All Users<br>Receive Message</div>
            </div>
        </div>

        <h2>6. High-Frequency Data Solutions</h2>
        
        <h3>When Webhooks Break Down</h3>
        <div class="diagram">
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-title">Individual Webhooks</div>
                    <div class="metric-value">1000 TCP connections/second</div>
                    <div style="color: #e74c3c; margin-top: 10px;">❌ Server exhausted</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">Network Overhead per Call</div>
                    <div>DNS Lookup: ~5ms<br>
                    TCP Handshake: ~50ms<br>
                    TLS Handshake: ~100ms<br>
                    HTTP Request/Response: ~100ms</div>
                    <div style="color: #e74c3c; margin-top: 10px;">Total: ~265ms per webhook</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">Batched Webhooks</div>
                    <div class="metric-value">20 connections/second</div>
                    <div style="color: #27ae60; margin-top: 10px;">✅ 50x reduction in overhead</div>
                </div>
            </div>
        </div>

        <h3>Solution Comparison</h3>
        <div class="diagram">
            <div class="performance-bars">
                <div class="perf-item">
                    <span class="perf-label">Individual Webhooks</span>
                    <div class="perf-bar" style="width: 50px; background: #e74c3c;">
                        <span class="perf-text">1-10/sec</span>
                    </div>
                </div>
                <div class="perf-item">
                    <span class="perf-label">Batched Webhooks</span>
                    <div class="perf-bar" style="width: 150px; background: #f39c12;">
                        <span class="perf-text">100-1k/sec</span>
                    </div>
                </div>
                <div class="perf-item">
                    <span class="perf-label">Server-Sent Events</span>
                    <div class="perf-bar" style="width: 250px; background: #3498db;">
                        <span class="perf-text">1k-10k/sec</span>
                    </div>
                </div>
                <div class="perf-item">
                    <span class="perf-label">WebSockets</span>
                    <div class="perf-bar" style="width: 350px; background: #27ae60;">
                        <span class="perf-text">10k-100k/sec</span>
                    </div>
                </div>
                <div class="perf-item">
                    <span class="perf-label">Message Queues</span>
                    <div class="perf-bar" style="width: 400px; background: #9b59b6;">
                        <span class="perf-text">Unlimited</span>
                    </div>
                </div>
            </div>
        </div>

        <h2>7. Pattern Comparison Matrix</h2>
        
        <div class="diagram">
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Pattern</th>
                        <th>Latency</th>
                        <th>Reliability</th>
                        <th>Complexity</th>
                        <th>Scalability</th>
                        <th>Use Case</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Individual Webhooks</strong></td>
                        <td>Low (50-200ms)</td>
                        <td>Medium</td>
                        <td>Low</td>
                        <td>Low</td>
                        <td>&lt; 10/second</td>
                    </tr>
                    <tr>
                        <td><strong>Batched Webhooks</strong></td>
                        <td>Medium (1-2s)</td>
                        <td>Medium</td>
                        <td>Low</td>
                        <td>Medium</td>
                        <td>10-500/second</td>
                    </tr>
                    <tr>
                        <td><strong>Server-Sent Events</strong></td>
                        <td>Low (50-200ms)</td>
                        <td>Medium</td>
                        <td>Medium</td>
                        <td>High</td>
                        <td>100-10k/second</td>
                    </tr>
                    <tr>
                        <td><strong>WebSockets</strong></td>
                        <td>Very Low (&lt;50ms)</td>
                        <td>Medium</td>
                        <td>High</td>
                        <td>High</td>
                        <td>Real-time apps</td>
                    </tr>
                    <tr>
                        <td><strong>Message Queues</strong></td>
                        <td>Medium (1-5s)</td>
                        <td>Very High</td>
                        <td>Medium</td>
                        <td>Very High</td>
                        <td>Any volume</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <h2>8. AWS Serverless Architecture</h2>
        
        <div class="diagram">
            <div class="architecture-diagram">
                <div class="arch-section" style="border-color: #27ae60;">
                    <div class="arch-title">Data Layer</div>
                    <div class="node database">DynamoDB Table<br>Orders</div>
                    <div style="margin: 10px 0;">↓</div>
                    <div class="node database">DynamoDB Stream<br>Change Events</div>
                </div>
                
                <div class="arch-section" style="border-color: #3498db;">
                    <div class="arch-title">Event Processing</div>
                    <div class="node info">Lambda Function<br>Order Processor</div>
                    <div style="margin: 10px 0;">↓</div>
                    <div class="node queue">SNS Topic<br>Order Events</div>
                </div>
                
                <div class="arch-section" style="border-color: #9b59b6;">
                    <div class="arch-title">Multiple Delivery Channels</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div class="node service" style="font-size: 12px;">Email via SES</div>
                        <div class="node service" style="font-size: 12px;">SMS via SNS</div>
                        <div class="node service" style="font-size: 12px;">HTTP Webhook</div>
                        <div class="node service" style="font-size: 12px;">SQS Queue</div>
                    </div>
                </div>
            </div>
            <div class="timeline" style="background: #e8f5e8; border-left-color: #27ae60;">
                <strong>Serverless Benefits:</strong><br>
                • No servers to manage<br>
                • Automatic scaling<br>
                • Pay per execution<br>
                • High availability<br>
                • Event-driven architecture
            </div>
        </div>

        <h2>9. Decision Tree: Choosing the Right Pattern</h2>
        
        <div class="diagram">
            <div class="decision-tree">
                <div class="decision-node">
                    What type of communication do you need?
                </div>
                <div class="decision-options">
                    <div class="option">
                        <strong>One-way (AWS → Azure)</strong><br>
                        How frequent are updates?<br>
                        <small>
                            • &lt; 10/sec: Individual Webhooks<br>
                            • 10-500/sec: Batched Webhooks<br>
                            • 500-10k/sec: Server-Sent Events<br>
                            • &gt; 10k/sec: Message Queues
                        </small>
                    </div>
                    <div class="option">
                        <strong>Two-way (Bidirectional)</strong><br>
                        Real-time requirements?<br>
                        <small>
                            • &lt; 100ms latency: WebSockets<br>
                            • 1-5 seconds OK: Webhook + Callback
                        </small>
                    </div>
                </div>
            </div>
        </div>

        <h2>10. Security Architecture Patterns</h2>
        
        <div class="diagram">
            <h3>Webhook Security Layers</h3>
            <div class="flow-diagram">
                <div class="node error" style="font-size: 12px;">Request Origin</div>
                <div class="arrow"></div>
                <div class="node error" style="font-size: 12px;">IP Whitelisting</div>
                <div class="arrow"></div>
                <div class="node success" style="font-size: 12px;">HTTPS/TLS</div>
                <div class="arrow"></div>
                <div class="node info" style="font-size: 12px;">API Key Auth</div>
                <div class="arrow"></div>
                <div class="node" style="background: #f3e5f5; color: #333; font-size: 12px;">Signature Verify</div>
                <div class="arrow"></div>
                <div class="node warning" style="font-size: 12px;">Body Validation</div>
                <div class="arrow"></div>
                <div class="node" style="background: #ffecb3; color: #333; font-size: 12px;">Rate Limiting</div>
                <div class="arrow"></div>
                <div class="node success" style="font-size: 12px;">Process Request</div>
            </div>
        </div>

        <h2>11. Error Handling and Retry Patterns</h2>
        
        <div class="diagram">
            <div class="flow-diagram" style="flex-direction: column; align-items: center;">
                <div class="node info">Webhook Request Sent</div>
                <div style="margin: 20px 0;">↓</div>
                <div class="node warning">Check Response Code</div>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 20px 0;">
                    <div>
                        <div class="node success">2xx Success</div>
                        <div style="margin: 10px 0;">↓</div>
                        <div class="node success" style="font-size: 12px;">✅ Complete</div>
                    </div>
                    <div>
                        <div class="node warning">4xx Client Error</div>
                        <div style="margin: 10px 0;">↓</div>
                        <div class="node warning" style="font-size: 12px;">❌ Don't Retry<br>Alert Team</div>
                    </div>
                    <div>
                        <div class="node error">5xx Server Error</div>
                        <div style="margin: 10px 0;">↓</div>
                        <div class="node error" style="font-size: 12px;">Retry with<br>Backoff</div>
                    </div>
                </div>
                <div class="timeline">
                    <strong>Retry Schedule Example:</strong><br>
                    • Attempt 1: Immediate<br>
                    • Attempt 2: 2 seconds later<br>
                    • Attempt 3: 4 seconds later<br>
                    • Attempt 4: 8 seconds later<br>
                    • Failure: Dead letter queue
                </div>
            </div>
        </div>

        <h2>12. Cost Optimization Strategies</h2>
        
        <div class="diagram">
            <div class="architecture-diagram">
                <div class="arch-section" style="border-color: #3498db;">
                    <div class="arch-title">AWS Cost Optimization</div>
                    <div style="text-align: left; font-size: 14px;">
                        • Use Reserved Instances<br>
                        <span style="color: #27ae60;">40-60% cost reduction</span><br><br>
                        • Auto Scaling Groups<br>
                        <span style="color: #27ae60;">Scale down during off-hours</span><br><br>
                        • SQS Batching<br>
                        <span style="color: #27ae60;">Reduce API call costs</span><br><br>
                        • CloudWatch Log Retention<br>
                        <span style="color: #27ae60;">30 days instead of forever</span>
                    </div>
                </div>
                
                <div class="arch-section" style="border-color: #e74c3c;">
                    <div class="arch-title">Azure Cost Optimization</div>
                    <div style="text-align: left; font-size: 14px;">
                        • App Service Plans<br>
                        <span style="color: #27ae60;">Shared during development</span><br><br>
                        • Azure SQL Elastic Pools<br>
                        <span style="color: #27ae60;">Share resources across DBs</span><br><br>
                        • Function Apps<br>
                        <span style="color: #27ae60;">Consumption plan for sporadic</span><br><br>
                        • Storage Lifecycle Policies<br>
                        <span style="color: #27ae60;">Archive old webhook logs</span>
                    </div>
                </div>
                
                <div class="arch-section" style="border-color: #f39c12;">
                    <div class="arch-title">Architecture Cost Comparison<br><small>(1000 webhooks/day)</small></div>
                    <div class="metrics-grid" style="grid-template-columns: 1fr;">
                        <div class="metric-card" style="border-left-color: #f39c12;">
                            <div class="metric-title">Basic Webhooks</div>
                            <div class="metric-value">£25/month</div>
                            <small>EC2 + App Service always on</small>
                        </div>
                        <div class="metric-card" style="border-left-color: #27ae60;">
                            <div class="metric-title">Serverless</div>
                            <div class="metric-value">£8/month</div>
                            <small>Lambda + Azure Functions</small>
                        </div>
                        <div class="metric-card" style="border-left-color: #3498db;">
                            <div class="metric-title">Hybrid</div>
                            <div class="metric-value">£15/month</div>
                            <small>Best of both approaches</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <h2>13. Common Anti-Patterns to Avoid</h2>
        
        <div class="diagram">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                <div>
                    <h3 style="color: #e74c3c;">❌ What NOT to Do</h3>
                    <div class="metric-card" style="border-left-color: #e74c3c;">
                        <div class="metric-title">Synchronous Processing</div>
                        <div>Block webhook response while doing heavy work</div>
                    </div>
                    <div class="metric-card" style="border-left-color: #e74c3c;">
                        <div class="metric-title">No Retry Logic</div>
                        <div>Give up after first failure without attempting retry</div>
                    </div>
                    <div class="metric-card" style="border-left-color: #e74c3c;">
                        <div class="metric-title">Infinite Retries</div>
                        <div>Keep retrying forever without backoff or limit</div>
                    </div>
                    <div class="metric-card" style="border-left-color: #e74c3c;">
                        <div class="metric-title">No Authentication</div>
                        <div>Accept webhooks from any source without verification</div>
                    </div>
                    <div class="metric-card" style="border-left-color: #e74c3c;">
                        <div class="metric-title">Large Payloads</div>
                        <div>Send entire database records instead of just changes</div>
                    </div>
                </div>
                
                <div>
                    <h3 style="color: #27ae60;">✅ Best Practices Instead</h3>
                    <div class="metric-card" style="border-left-color: #27ae60;">
                        <div class="metric-title">Async Processing</div>
                        <div>Return 200 immediately, process in background</div>
                    </div>
                    <div class="metric-card" style="border-left-color: #27ae60;">
                        <div class="metric-title">Exponential Backoff</div>
                        <div>Smart retry with increasing delays</div>
                    </div>
                    <div class="metric-card" style="border-left-color: #27ae60;">
                        <div class="metric-title">Circuit Breaker</div>
                        <div>Stop retrying after reasonable attempts</div>
                    </div>
                    <div class="metric-card" style="border-left-color: #27ae60;">
                        <div class="metric-title">Strong Authentication</div>
                        <div>Verify signatures and API keys properly</div>
                    </div>
                    <div class="metric-card" style="border-left-color: #27ae60;">
                        <div class="metric-title">Minimal Payloads</div>
                        <div>Send only essential data, provide API for details</div>
                    </div>
                </div>
            </div>
        </div>

        <h2>14. Evolution Path: From Simple to Enterprise</h2>
        
        <div class="diagram">
            <div class="flow-diagram">
                <div class="node info">Phase 1: MVP<br><small>(Month 1)</small><br>Simple Webhooks<br>Basic error logging</div>
                <div class="arrow"></div>
                <div class="node success">Phase 2: Production<br><small>(Month 3)</small><br>Add Authentication<br>Retry logic<br>Basic monitoring</div>
                <div class="arrow"></div>
                <div class="node warning">Phase 3: Scale<br><small>(Month 6)</small><br>Batched webhooks<br>Load balancing<br>DB optimization</div>
                <div class="arrow"></div>
                <div class="node" style="background: #f3e5f5; color: #333;">Phase 4: Enterprise<br><small>(Month 12)</small><br>Message queues<br>Multi-region<br>Advanced analytics</div>
            </div>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-title">Phase 1: Get it working</div>
                    <div class="metric-value">1-10 webhooks/day</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">Phase 2: Make it reliable</div>
                    <div class="metric-value">10-100 webhooks/day</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">Phase 3: Handle growth</div>
                    <div class="metric-value">100-10k webhooks/day</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">Phase 4: Enterprise scale</div>
                    <div class="metric-value">10k+ webhooks/day</div>
                </div>
            </div>
        </div>

        <h2>15. Production Architecture Example</h2>
        
        <div class="diagram">
            <div class="architecture-diagram">
                <div class="arch-section" style="border-color: #3498db;">
                    <div class="arch-title">AWS Production Environment</div>
                    <div class="flow-diagram" style="flex-direction: column;">
                        <div class="node info" style="font-size: 12px;">Application Load Balancer</div>
                        <div style="margin: 5px 0;">↓</div>
                        <div class="node info" style="font-size: 12px;">EC2 Auto Scaling Group</div>
                        <div style="margin: 5px 0;">↓</div>
                        <div class="node info" style="font-size: 12px;">Flask Applications</div>
                        <div style="margin: 10px 0; display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
                            <div class="node database" style="font-size: 10px;">RDS PostgreSQL<br>Multi-AZ</div>
                            <div class="node" style="background: #ffecb3; color: #333; font-size: 10px;">Redis Cluster<br>Session/Cache</div>
                        </div>
                        <div class="node queue" style="font-size: 12px;">SQS Queue<br>Dead Letter Queue</div>
                    </div>
                </div>
                
                <div class="arch-section" style="border-color: #9b59b6;">
                    <div class="arch-title">Monitoring & Security</div>
                    <div style="text-align: left; font-size: 12px;">
                        • CloudWatch Logs<br>
                        • CloudWatch Metrics<br>
                        • AWS WAF<br>
                        • VPC Security Groups<br><br>
                        <strong>Security Features:</strong><br>
                        • Webhook signature verification<br>
                        • API key authentication<br>
                        • IP whitelisting<br>
                        • HTTPS encryption
                    </div>
                </div>
                
                <div class="arch-section" style="border-color: #e74c3c;">
                    <div class="arch-title">Azure Partner Environment</div>
                    <div class="flow-diagram" style="flex-direction: column;">
                        <div class="node service" style="font-size: 12px;">Azure Application Gateway</div>
                        <div style="margin: 5px 0;">↓</div>
                        <div class="node service" style="font-size: 12px;">App Service<br>Multiple Instances</div>
                        <div style="margin: 10px 0; display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
                            <div class="node" style="background: #d1c4e9; color: #333; font-size: 10px;">Azure SQL Database<br>Geo-Redundant</div>
                            <div class="node queue" style="font-size: 10px;">Service Bus Queue</div>
                        </div>
                        <div class="node service" style="font-size: 12px;">Application Insights</div>
                    </div>
                </div>
            </div>
        </div>

        <h2>16. Monitoring and Observability</h2>
        
        <div class="diagram">
            <div class="metrics-grid">
                <div class="metric-card" style="border-left-color: #27ae60;">
                    <div class="metric-title">Webhook Success Rate</div>
                    <div class="metric-value">Target: > 99.9%</div>
                </div>
                <div class="metric-card" style="border-left-color: #3498db;">
                    <div class="metric-title">Average Response Time</div>
                    <div class="metric-value">Target: < 200ms</div>
                </div>
                <div class="metric-card" style="border-left-color: #f39c12;">
                    <div class="metric-title">Queue Depth</div>
                    <div class="metric-value">Alert if > 1000</div>
                </div>
                <div class="metric-card" style="border-left-color: #9b59b6;">
                    <div class="metric-title">Error Rate by Type</div>
                    <div class="metric-value">4xx vs 5xx patterns</div>
                </div>
            </div>
            
            <h3>Alerting Thresholds</h3>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 20px 0;">
                <div class="metric-card" style="border-left-color: #e74c3c;">
                    <div class="metric-title">🚨 Critical</div>
                    <div>Success rate < 95%<br>Page on-call team</div>
                </div>
                <div class="metric-card" style="border-left-color: #f39c12;">
                    <div class="metric-title">📧 Warning</div>
                    <div>Response time > 500ms<br>Send email alert</div>
                </div>
                <div class="metric-card" style="border-left-color: #3498db;">
                    <div class="metric-title">📊 Info</div>
                    <div>New partner onboarded<br>Update dashboard</div>
                </div>
            </div>
        </div>

        <h2>17. Code Examples</h2>
        
        <div class="diagram">
            <h3>Robust Webhook Implementation</h3>
            <div class="code-example">
import requests
from tenacity import retry, stop_after_attempt, wait_exponential

class RobustNotifier:
    def __init__(self):
        self.primary_webhook = "https://azure-saas.com/webhook"
        self.fallback_queue = boto3.client('sqs')
    
    @retry(
        stop=stop_after_attempt(3),
        wait=wait_exponential(multiplier=1, min=4, max=10)
    )
    def send_notification(self, order_data):
        try:
            response = requests.post(
                self.primary_webhook,
                json=order_data,
                timeout=30,
                headers={'X-Signature': self.generate_signature(order_data)}
            )
            response.raise_for_status()
            
        except requests.exceptions.RequestException:
            # Fallback to queue
            self.fallback_queue.send_message(
                QueueUrl='https://sqs.region.amazonaws.com/fallback',
                MessageBody=json.dumps(order_data)
            )
            raise  # Re-raise for retry logic
            </div>
            
            <h3>WebSocket Chat Server</h3>
            <div class="code-example">
from flask_socketio import SocketIO, emit, join_room

app = Flask(__name__)
socketio = SocketIO(app)

@socketio.on('join_chat')
def handle_join(data):
    username = data['username']
    room = data['room']
    join_room(room)
    
    # Tell everyone in room that user joined
    emit('user_joined', {
        'message': f'{username} joined the chat'
    }, room=room)

@socketio.on('send_message')
def handle_message(data):
    # Send to everyone in room instantly
    emit('new_message', {
        'username': data['username'],
        'message': data['message'],
        'timestamp': datetime.utcnow().isoformat()
    }, room=data['room'])
            </div>
        </div>

        <h2>Key Takeaways</h2>
        
        <div class="diagram" style="background: #e8f5e8; border-left: 4px solid #27ae60;">
            <div class="metrics-grid">
                <div class="metric-card" style="border-left-color: #3498db;">
                    <div class="metric-title">Start Simple</div>
                    <div>Begin with webhooks for low-frequency notifications</div>
                </div>
                <div class="metric-card" style="border-left-color: #27ae60;">
                    <div class="metric-title">Scale Smartly</div>
                    <div>Move to batching, SSE, or queues as volume increases</div>
                </div>
                <div class="metric-card" style="border-left-color: #f39c12;">
                    <div class="metric-title">Choose Based on Requirements</div>
                    <div>Consider latency, reliability, and complexity needs</div>
                </div>
                <div class="metric-card" style="border-left-color: #e74c3c;">
                    <div class="metric-title">Plan for Failure</div>
                    <div>Implement retry logic, monitoring, and fallback mechanisms</div>
                </div>
                <div class="metric-card" style="border-left-color: #9b59b6;">
                    <div class="metric-title">Security First</div>
                    <div>Always verify webhook signatures and use HTTPS</div>
                </div>
                <div class="metric-card" style="border-left-color: #34495e;">
                    <div class="metric-title">Monitor Everything</div>
                    <div>Track success rates, latency, and error patterns</div>
                </div>
            </div>
        </div>

        <footer style="margin-top: 50px; padding-top: 20px; border-top: 1px solid #bdc3c7; text-align: center; color: #666;">
            <p>This guide demonstrates the evolution from simple request-response to sophisticated event-driven architectures.</p>
            <p>Each pattern has its place - the key is choosing the right tool for your specific requirements.</p>
        </footer>
    </div>
</body>
</html>